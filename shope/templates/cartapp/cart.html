{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load get_price %}


{% block title %}
Megano
{% endblock %}

        {% block wrap %}
            <div class="wrap">
                <div class="row Header-rowMain">
                    <div class="row-block Header-logo"><a class="logo" href="{% url 'coreapp:index' %}"><img class="logo-image" src="{% static 'assets/img/logo.png' %}" alt="logo.png" /></a>
                    </div>
                    <nav class="row-block row-block_right Header-menu">
                        <div class="menuModal" id="navigate">
                            <ul class="menu menu_main">
                                <li class="menu-item"><a class="menu-link" href="{% url 'coreapp:index' %}">{% translate 'Home' %}</a>
                                </li>
                                <li class="menu-item"><a href="{% url 'productsapp:sales' %}"><span class="menu-label menu-label_success">{% translate 'Discounts' %}</span></a><a class="menu-link" href="{% url 'productsapp:catalog' %}">{% translate 'Catalog' %}</a>
                                </li>
                                <li class="menu-item"><a class="menu-link" href="{% url 'productsapp:comparison' %}">{% translate 'Comparison' %}
                                    <span style="
                                        background: #0063d1;
                                        position: absolute;
                                        right: -14px;
                                        top: 0px;
                                        min-width: 23px;
                                        font-size: 12px;
                                        letter-spacing: -0.6px;
                                        color: #fff;
                                        padding: 2px;
                                        line-height: 1.2em;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        border: 3px solid #fff;
                                        border-radius: 100px;
                                    ">{% firstof count_comparis '0' %}</span></a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    <div class="row-block">

                        <div class="CartBlock">
                            <div class="dropdown">
                                {% if user.is_authenticated %}
                                <button class="dropbtn"><img class="CartBlock-img" src="{% static 'assets/img/icons/loon-icon.svg' %}" alt="loon-icon.svg" /></button>
                                <div class="dropdown-content">
                                    <a class="dropdown-content-a" href="{% url 'profileapp:account' %}">{% translate 'Private Office' %}</a>
                                    <a class="dropdown-content-a" href="#">{% translate 'Administrative section' %}</a>
                                    <a class="dropdown-content-a" href="{% url 'authapp:logout' %}">{% translate 'Output' %}</a>
                                </div>
                                {% endif %}
                            </div>
                            {% if session %}
                            <a class="CartBlock-block" href="{% url 'cartapp:cart' %}"><img class="CartBlock-img" src="{% static 'assets/img/icons/cart.svg' %}" alt="{% static 'cart.svg'%}" /><span class="CartBlock-amount">{% firstof count_cart '0' %}</span></a>
                            <div class="CartBlock-block"><span class="CartBlock-price">{% firstof total_amount '0' %}</span>
                            </div>
                            {% else %}
                            <a class="CartBlock-block" href="{% url 'cartapp:cart' %}"><img class="CartBlock-img" src="{% static 'assets/img/icons/cart.svg' %}" alt="{% static 'cart.svg'%}" /><span class="CartBlock-amount">{% firstof cart_count '0' %}</span></a>
                            <div class="CartBlock-block"><span class="CartBlock-price">{% firstof cart_sum '0' %}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row-block Header-trigger"><a class="menuTrigger" href="#navigate">
                            <div class="menuTrigger-content">{% translate 'Show navigation' %}
                            </div><span></span><span></span><span></span>
                        </a>
                    </div>
                </div>
            </div>
        {% endblock %}
{% block Header-slider %}
{% endblock %}

{% block content %}
<div class="Middle Middle_top">
    <div class="Section">
        <div class="wrap">
            {% if items %}
            <form class="form Cart" action="#" method="post">
                {% csrf_token %}
                {% if session %}
                {% for count, item, discounted_price in items %}
                <div class="Cart-product">
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_pict">
                            <a class="Cart-pict" href="#">
                                <img class="Cart-img" src="{{item.product.product_images.first.image.url}}" alt="card.jpg"/>
                            </a>
                        </div>
                        <div class="Cart-block Cart-block_info"><a class="Cart-title"
                                                                   href="{% url 'productsapp:product_detail' item.product.pk %}">{{item.product.name}}</a>
                            <div class="Cart-desc">{{item.product.description}}
                            </div>
                             <br>
                            <div class="seller-cart">
                                {% translate 'Seller' %}: {{item.seller.name}}
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_price">
                            {% if item.value != discounted_price %}
                                <div class="Cart-price discounted_price">
                                    {{item.value}}&nbsp;&#8381;
                                </div>
                                <div class="Cart-price">
                                    {{discounted_price}}&nbsp;&#8381;
                                </div>
                            {% else %}
                                <div class="Cart-price">
                                    {{item.value}}&nbsp;&#8381;
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_seller">
                            <!-- - var options = setOptions(items, ['value', 'selected', 'disabled']);-->

                        </div>
                        <div class="Cart-block Cart-block_amount">
                            <div class="Cart-amount">
                                <div class="Amount">
                                    <button class="Amount-remove"
                                            formaction="{% url 'cartapp:remove_product' item.product.pk item.seller.pk %}"
                                            type="button">
                                    </button>
                                    <input class="Amount-input form-input" name="amount" type="text"
                                           value={{count}} formmethod="get"/>
                                    <button class="Amount-add" type="submit"
                                            formaction="{% url 'cartapp:add_product' item.product.pk item.seller.pk %}"
                                            formmethod="get">
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_delete"><a class="Cart-delete"
                                                                     href="{% url 'cartapp:delete_product' item.product.pk item.seller.pk %}"><img
                                src="{% static 'assets/img/icons/card/delete.svg' %}" alt="delete.svg"/></a>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <div class="Cart-total">
                    <div class="Cart-block Cart-block_total">
                        <strong class="Cart-title">{% translate 'Total' %}:
                        </strong><span class="Cart-price">{% firstof cart_sum '0' %}&nbsp;&#8381;</span>
                    </div>
                    <div class="Cart-block">
                        <a class="btn btn_success btn_lg" href="{% url 'authapp:login' %}?next={% url 'cartapp:cart' %}">{% translate 'Log in to continue' %}</a>
                    </div>
                </div>
                {% else %}
                {% for item in items %}
                <div class="Cart-product">
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_pict">
                            <a class="Cart-pict" href="{% url 'productsapp:product_detail' item.product.pk %}">
                                <img class="Cart-img" src="{{item.product.product_images.first.image.url}}" alt="card.jpg"/>
                            </a>
                        </div>
                        <div class="Cart-block Cart-block_info"><a class="Cart-title"
                                                                   href="{% url 'productsapp:product_detail' item.product.pk %}">{{item.product.name}}</a>
                            <div class="Cart-desc">{{item.product.description}}
                            </div>
                            <br>
                            <div class="seller-cart">
                                {% translate 'Seller' %}: {{item.seller.name}}
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_price">
                            {% if item.price != item.discounted_price %}
                                <div class="Cart-price discounted_price">
                                    {{item.price}}&nbsp;&#8381;
                                </div>
                                <div class="Cart-price">
                                    {{item.discounted_price}}&nbsp;&#8381;
                                </div>
                            {% else %}
                                <div class="Cart-price">
                                    {{item.price}}&nbsp;&#8381;
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_seller">
                            <!-- - var options = setOptions(items, ['value', 'selected', 'disabled']);-->

                        </div>
                        <div class="Cart-block Cart-block_amount">
                            <div class="Cart-amount">
                                <div class="Amount">
                                    <button class="Amount-remove"
                                            formaction="{% url 'cartapp:remove_product' item.product.pk item.seller.pk %}"
                                            type="button">
                                    </button>
                                    <input class="Amount-input form-input" name="amount" type="text"
                                           value={{item.quantity}} formmethod="get"/>
                                    <button class="Amount-add" type="submit"
                                            formaction="{% url 'cartapp:add_product' item.product.pk item.seller.pk %}"
                                            formmethod="get">
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_delete"><a class="Cart-delete"
                                                                     href="{% url 'cartapp:delete_product' item.product.pk item.seller.pk %}"><img
                                src="{% static 'assets/img/icons/card/delete.svg' %}" alt="delete.svg"/></a>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <div class="Cart-total">
                    <div class="Cart-block Cart-block_total">
                        <strong class="Cart-title">{% translate 'Total' %}:
                        </strong>
                        {% if session %}
                        <span class="Cart-price">{% firstof total_amount '0' %} &#x20bd</span>
                        {% else %}
                        <span class="Cart-price">{% firstof cart_sum '0' %} &#x20bd</span>
                        {% endif %}
                    </div>
                    <div class="Cart-block"><button class="btn btn_success btn_lg" type="submit" formmethod="post" formaction="{% url 'orderapp:add_order' %}">{% translate 'Place an order' %}</button>
                    </div>
                </div>
            </form>
            {% endif %}
            {% else %}
            <h2 class="empty-cart">{% translate 'No products in cart' %}</h2>
            <div></div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

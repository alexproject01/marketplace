{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load get_price %}


{% block title %}
Megano
{% endblock %}


{% block Header-slider %}
{% endblock %}

{% block content %}
<div class="Middle Middle_top">
    <div class="Section">
        <div class="wrap">
            {% if items %}
            <form class="form Cart" action="#" method="post">
                {% csrf_token %}
                {% if session %}
                {% for count, item, discounted_price in items %}
                <div class="Cart-product">
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_pict">
                            <a class="Cart-pict" href="#">
                                <img class="Cart-img" src="{{item.product.product_images.first.image.url}}" alt="card.jpg"/>
                            </a>
                        </div>
                        <div class="Cart-block Cart-block_info"><a class="Cart-title"
                                                                   href="{% url 'productsapp:product_detail' item.product.pk %}">{{item.product.name}}</a>
                            <div class="Cart-desc">{{item.product.description}}
                            </div>
                             <br>
                            <div class="seller-cart">
                                {% translate 'Seller' %}: {{item.seller.name}}
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_price">
                            {% if item.value != discounted_price %}
                                <div class="Cart-price discounted_price">
                                    {{item.value}}&nbsp;&#8381;
                                </div>
                                <div class="Cart-price">
                                    {{discounted_price}}&nbsp;&#8381;
                                </div>
                            {% else %}
                                <div class="Cart-price">
                                    {{item.value}}&nbsp;&#8381;
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_seller">
                            <!-- - var options = setOptions(items, ['value', 'selected', 'disabled']);-->

                        </div>
                        <div class="Cart-block Cart-block_amount">
                            <div class="Cart-amount">
                                <div class="Amount">
                                    <button class="Amount-remove"
                                            formaction="{% url 'cartapp:remove_product' item.product.pk item.seller.pk %}"
                                            type="button">
                                    </button>
                                    <input class="Amount-input form-input" name="amount" type="text"
                                           value={{count}} formmethod="get"/>
                                    <button class="Amount-add" type="submit"
                                            formaction="{% url 'cartapp:add_product' item.product.pk item.seller.pk %}"
                                            formmethod="get">
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_delete"><a class="Cart-delete"
                                                                     href="{% url 'cartapp:delete_product' item.product.pk item.seller.pk %}"><img
                                src="{% static 'assets/img/icons/card/delete.svg' %}" alt="delete.svg"/></a>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <div class="Cart-total">
                    <div class="Cart-block Cart-block_total">
                        <strong class="Cart-title">{% translate 'Total' %}:
                        </strong><span class="Cart-price">{% firstof cart_sum '0' %}&nbsp;&#8381;</span>
                    </div>
                    <div class="Cart-block">
                        <a class="btn btn_success btn_lg" href="{% url 'authapp:login' %}?next={% url 'cartapp:cart' %}">{% translate 'Log in to continue' %}</a>
                    </div>
                </div>
                {% else %}
                {% for item in items %}
                <div class="Cart-product">
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_pict">
                            <a class="Cart-pict" href="{% url 'productsapp:product_detail' item.product.pk %}">
                                <img class="Cart-img" src="{{item.product.product_images.first.image.url}}" alt="card.jpg"/>
                            </a>
                        </div>
                        <div class="Cart-block Cart-block_info"><a class="Cart-title"
                                                                   href="{% url 'productsapp:product_detail' item.product.pk %}">{{item.product.name}}</a>
                            <div class="Cart-desc">{{item.product.description}}
                            </div>
                            <br>
                            <div class="seller-cart">
                                {% translate 'Seller' %}: {{item.seller.name}}
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_price">
                            {% if item.price != item.discounted_price %}
                                <div class="Cart-price discounted_price">
                                    {{item.price}}&nbsp;&#8381;
                                </div>
                                <div class="Cart-price">
                                    {{item.discounted_price}}&nbsp;&#8381;
                                </div>
                            {% else %}
                                <div class="Cart-price">
                                    {{item.price}}&nbsp;&#8381;
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="Cart-block Cart-block_row">
                        <div class="Cart-block Cart-block_seller">
                            <!-- - var options = setOptions(items, ['value', 'selected', 'disabled']);-->

                        </div>
                        <div class="Cart-block Cart-block_amount">
                            <div class="Cart-amount">
                                <div class="Amount">
                                    <button class="Amount-remove"
                                            formaction="{% url 'cartapp:remove_product' item.product.pk item.seller.pk %}"
                                            type="button">
                                    </button>
                                    <input class="Amount-input form-input" name="amount" type="text"
                                           value={{item.quantity}} formmethod="get"/>
                                    <button class="Amount-add" type="submit"
                                            formaction="{% url 'cartapp:add_product' item.product.pk item.seller.pk %}"
                                            formmethod="get">
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="Cart-block Cart-block_delete"><a class="Cart-delete"
                                                                     href="{% url 'cartapp:delete_product' item.product.pk item.seller.pk %}"><img
                                src="{% static 'assets/img/icons/card/delete.svg' %}" alt="delete.svg"/></a>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <div class="Cart-total">
                    <div class="Cart-block Cart-block_total">
                        <strong class="Cart-title">{% translate 'Total' %}:
                        </strong><span class="Cart-price">{% firstof cart_sum '0' %} &#x20bd</span>
                    </div>
                    <div class="Cart-block"><button class="btn btn_success btn_lg" type="submit" formmethod="post" formaction="{% url 'orderapp:add_order' %}">{% translate 'Place an order' %}</button>
                    </div>
                </div>
            </form>
            {% endif %}
            {% else %}
            <h2 class="empty-cart">{% translate 'No products in cart' %}</h2>
            <div></div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
